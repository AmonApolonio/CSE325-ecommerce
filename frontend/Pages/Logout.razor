@page "/logout"
@using frontend.Services
@using Microsoft.AspNetCore.Components.Web
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
@inject CustomAuthStateProvider AuthStateProvider

<PageTitle>Logout - SharpCraft Shop</PageTitle>

@code {
    protected override async Task OnInitializedAsync()
    {
        // 1. Remove as chaves de autenticação e sessão do localStorage
        await JSRuntime.InvokeVoidAsync("localStorage.removeItem", "authToken");
        
        // --- AJUSTES APLICADOS AQUI ---
        // Garante que o Email e o Role (usados para identificar o usuário no frontend)
        // sejam completamente removidos do armazenamento persistente do navegador.
        await JSRuntime.InvokeVoidAsync("localStorage.removeItem", "userEmail");
        await JSRuntime.InvokeVoidAsync("localStorage.removeItem", "userRole");
        // -----------------------------

        // 2. Atualiza o estado de autenticação no Blazor
        // Isso força a reavaliação das políticas de autorização em toda a aplicação.
        AuthStateProvider.MarkUserAsLoggedOut();

        // 3. Redireciona para a página de login
        NavigationManager.NavigateTo("/login");
    }
}

<div class="min-h-screen bg-white flex items-center justify-center">
    <div class="text-center">
        <!-- Ícone de logout com cor de destaque -->
        <i class="fas fa-sign-out-alt text-orange-400 text-6xl mb-4"></i>
        <p class="text-xl text-gray-600 mb-4">Logging you out...</p>
        <div class="flex justify-center">
            <!-- Spinner simples de loading -->
            <div class="w-8 h-8 rounded-full border-4 border-orange-300 border-t-orange-400 animate-spin"></div>
        </div>
    </div>
</div>

@page "/"
@using frontend.Components.Product
@using frontend.Utils

@inject MockProductService ProductService
@inject MockCategoryService CategoryService
@inject MockCartService CartService
@inject NavigationManager NavigationManager

<PageTitle>Home - SharpCraft Shop</PageTitle>

@code {
    private List<ShoppingItem> _items = new();
    private List<string> _categories = new();
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        _isLoading = true;
        try
        {
            _items = await ProductService.GetShoppingItemsAsync();
            _categories = await CategoryService.GetCategoriesAsync();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading data: {ex.Message}");
        }
        finally
        {
            _isLoading = false;
        }
    }

    private void HandleProductClick(string productId)
    {
        NavigationManager.NavigateTo($"/item/{productId}");
    }

    private async Task HandleToggleCart(string productId)
    {
        // Find the item
        var item = _items.FirstOrDefault(i => i.Id == productId);
        if (item != null)
        {
            if (item.IsAddedToCart)
            {
                await CartService.RemoveFromCartAsync(productId);
            }
            else
            {
                await CartService.AddToCartAsync(item);
            }
            item.IsAddedToCart = !item.IsAddedToCart;
            StateHasChanged();
        }
    }

    private void HandleCategoryClick(string category)
    {
        NavigationManager.NavigateTo($"/search?category={category}");
    }
}

@if (_isLoading)
{
    <div class="flex items-center justify-center py-16">
        <div class="text-center">
            <i class="fas fa-spinner fa-spin text-orange-400 text-4xl mb-4"></i>
            <p class="text-gray-600">Loading products...</p>
        </div>
    </div>
}
else
{
    <div class="bg-white">
        @* Hero Section *@
        <section class="mb-8">
            <img
                src="/images/hero.jpg"
                alt="Hero Banner"
                class="w-full h-64 object-cover rounded-lg border-2 border-orange-300/50"
                style="width: 100%; height: 256px; object-fit: cover;"
            />
        </section>

        @* Featured Sellers Section *@
        <section>
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Featured Seller Items</h2>
            </div>

            <ProductGrid 
                Items="_items"
                OnProductClick="HandleProductClick"
                OnAddToCart="HandleToggleCart"
                OnRemoveFromCart="HandleToggleCart"
            />
        </section>

        @* Categories Section *@
        <section class="mt-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Shop by Category</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                @foreach (var category in _categories)
                {
                    <div
                        class="h-32 bg-orange-50 border-2 border-orange-300/50 border-dashed rounded-lg flex items-center justify-center transition-transform transform hover:scale-105 hover:bg-orange-300 cursor-pointer"
                        @onclick="@(() => HandleCategoryClick(category))"
                        role="button"
                        tabindex="0"
                    >
                        <span class="font-semibold text-gray-600">@category</span>
                    </div>
                }
            </div>
        </section>
    </div>
}
